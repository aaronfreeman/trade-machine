{"id":"trade-machine-0kj","title":"Fix critical UI bugs: missing JavaScript, icons, and HTMX responses","description":"The UI has three critical bugs preventing basic functionality:\n\n1. **showSection() function missing** - Navigation links call showSection() but it doesn't exist, so clicking sidebar items does nothing\n2. **Bootstrap Icons CDN not loaded** - Icons are referenced (bi-search, bi-lightbulb, etc.) but the CDN link is missing, making all icons invisible\n3. **API returns JSON instead of HTML** - HTMX expects HTML responses but handlers return JSON, so data never displays\n\nImplementation:\n- Add Bootstrap Icons CDN to layout.templ\n- Add showSection() JavaScript function to layout.templ\n- Add custom CSS with section visibility rules\n- Add HTMX error handling JavaScript\n\nFiles affected:\n- templates/layout.templ\n\nPriority: Critical (blocking all UI functionality)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T15:27:30.332688-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T15:49:00.887506-06:00","closed_at":"2026-01-17T15:49:00.887506-06:00","close_reason":"Fixed all critical UI bugs: added Bootstrap Icons CDN, implemented showSection() JavaScript with localStorage persistence, added comprehensive dark theme CSS, added HTMX error handling. All tests pass.","labels":["bug","priority:critical","ui"]}
{"id":"trade-machine-17k","title":"Migrate to chi or gorilla/mux router","description":"handler.go uses manual switch-case routing instead of a router library, making it verbose and lacking middleware support.\n\nCurrent problem:\n- handler.go:26-83 uses switch-case for routing\n- No built-in middleware support\n- Harder to add features (logging, auth, rate limiting)\n- More verbose code\n\nImplementation:\n- Add chi router (lightweight) or gorilla/mux\n- Refactor handler.go to use router\n- Add middleware for logging, CORS, timeouts\n- Group related routes\n\nExample:\nr := chi.NewRouter()\nr.Use(middleware.Logger)\nr.Get('/api/health', h.handleHealth)\nr.Route('/api/recommendations', func(r chi.Router) {\n    r.Get('/', h.handleGetRecommendations)\n    r.Post('/{id}/approve', h.handleApproveRecommendation)\n})\n\nPriority: Medium (Phase 2)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:17:52.512386-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T14:47:56.989781-06:00","closed_at":"2026-01-17T14:47:56.989784-06:00","labels":["enhancement","priority:medium"]}
{"id":"trade-machine-4tj","title":"Add centralized configuration management","description":"Currently configuration is scattered with os.Getenv() calls throughout the codebase. Create a config package that loads and validates all configuration at startup.\n\nFiles affected:\n- agents/manager.go (timeout, weights)\n- services/bedrock.go (Bedrock config)\n- app.go (concurrency limit)\n- handler.go (CORS)\n\nImplementation:\n- Create config/config.go with Config struct\n- Add validation for agent weights (must sum to 1.0)\n- Load and validate at startup in main.go\n- Inject config into components instead of reading env directly\n\nPriority: High (Phase 1)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:17:02.528314-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T13:46:44.547071-06:00","closed_at":"2026-01-17T13:46:44.547071-06:00","close_reason":"Closed","labels":["enhancement","priority:high"]}
{"id":"trade-machine-63p","title":"Add CQRS-lite: split repository into commands and queries","description":"Repository mixes query and command methods. Split into separate interfaces for better clarity and optimization.\n\nCurrent problem:\n- repository/ has mixed read/write operations\n- Unclear intent\n- Harder to optimize separately\n\nImplementation:\n- Create repository/commands.go with CommandRepository interface\n- Create repository/queries.go with QueryRepository interface\n- Update postgres.go to implement both\n- Refactor App to use separate interfaces where appropriate\n\nExample:\ntype CommandRepository interface {\n    CreateRecommendation(ctx context.Context, rec *models.Recommendation) error\n    ApproveRecommendation(ctx context.Context, id uuid.UUID) error\n}\n\ntype QueryRepository interface {\n    GetRecommendations(ctx context.Context, symbol string, limit int) ([]models.Recommendation, error)\n    GetPendingRecommendations(ctx context.Context) ([]models.Recommendation, error)\n}\n\nBenefits:\n- Clearer intent\n- Easier to optimize reads vs writes\n- Better separation for future scaling\n\nPriority: Low (Phase 3)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:18:54.916171-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T18:16:51.290817-06:00","closed_at":"2026-01-17T15:11:20.537568-06:00","labels":["enhancement","priority:low"]}
{"id":"trade-machine-800","title":"Update handlers to return HTML for HTMX requests","description":"Modify API handlers to detect HTMX requests and return HTML templates instead of JSON.\n\nDetection method:\nfunc isHTMXRequest(r *http.Request) bool {\n    return r.Header.Get(\"HX-Request\") == \"true\"\n}\n\nHandlers to update:\n1. handleAnalyzeStock - render analyze_result.templ\n2. handleGetPositions - render positions_list.templ\n3. handleGetRecommendations - render recommendations_list.templ\n4. handleGetPendingRecommendations - render recommendations_list.templ\n5. handleGetTrades - render trades_list.templ\n6. handleGetAgentRuns - render agent_runs_list.templ\n\nEach handler should:\n- Check if request is HTMX (HX-Request header)\n- If HTMX: render appropriate templ partial\n- If not HTMX: return JSON (preserve API compatibility)\n- Handle errors by rendering error_state.templ for HTMX\n\nExample:\nif isHTMXRequest(r) {\n    templates.PositionsList(positions).Render(r.Context(), w)\n    return\n}\nh.jsonResponse(w, positions)\n\nFiles affected:\n- handler.go\n\nPriority: High","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T15:29:26.052234-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T19:49:56.029188-06:00","closed_at":"2026-01-17T18:36:54.773719-06:00","labels":["enhancement","priority:high","ui"]}
{"id":"trade-machine-873","title":"Add observability layer with Prometheus metrics","description":"Limited visibility into system behavior. Add metrics collection for monitoring and debugging.\n\nCurrent problem:\n- No metrics collection\n- Hard to understand system behavior\n- No performance monitoring\n\nImplementation:\n- Add prometheus/client_golang\n- Create observability/metrics.go\n- Add metrics for:\n  - Analysis requests (counter by symbol)\n  - Agent duration (histogram by agent_type)\n  - Recommendation actions (counter by action)\n  - API errors (counter by service)\n  - Database query duration\n- Add /metrics endpoint\n- Consider adding OpenTelemetry tracing\n\nExample metrics:\n- analysis_requests_total{symbol}\n- agent_duration_seconds{agent_type}\n- recommendation_actions_total{action}\n- external_api_errors_total{service}\n\nPriority: Low (Phase 3)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:19:05.435016-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T22:56:54.044613-06:00","closed_at":"2026-01-17T22:50:46.101819-06:00","labels":["enhancement","observability","priority:low"]}
{"id":"trade-machine-8ki","title":"Add agent weight validation","description":"Agent weights are loaded independently with no validation that they sum to 1.0, which could cause incorrect score calculations.\n\nCurrent problem:\n- agents/manager.go:120-134 loads weights independently\n- No validation that weights sum to 1.0\n- Silent failures if misconfigured\n\nImplementation:\n- Add validation in config package (depends on issue trade-machine-4tj)\n- Check weights sum to 1.0 (with tolerance for floating point)\n- Return error at startup if invalid\n- Add unit tests for validation\n\nExample:\nfunc (c *AgentConfig) Validate() error {\n    sum := c.WeightFundamental + c.WeightNews + c.WeightTechnical\n    if math.Abs(sum - 1.0) \u003e 0.001 {\n        return fmt.Errorf('agent weights must sum to 1.0, got %.3f', sum)\n    }\n    return nil\n}\n\nPriority: Medium (Phase 2)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:17:41.590017-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T13:47:21.682386-06:00","closed_at":"2026-01-17T13:47:21.682386-06:00","close_reason":"Closed","labels":["bug","enhancement","priority:medium"]}
{"id":"trade-machine-b5o","title":"Implement professional dark theme color scheme","description":"Current UI uses basic Bootstrap dark classes which aren't visually appealing. Implement a professional GitHub-inspired dark theme for financial applications.\n\nColor palette:\n- Background: #0d1117 (primary), #161b22 (cards), #21262d (hover)\n- Text: #e6edf3 (primary), #8b949e (secondary), #6e7681 (muted)\n- Buy/Success: #3fb950 (green)\n- Sell/Danger: #f85149 (red)\n- Hold/Warning: #d29922 (amber)\n- Accent: #58a6ff (blue)\n- Agent colors: fundamental=#58a6ff, technical=#8957e5, news=#d29922\n\nImplementation:\n- Add CSS custom properties (:root variables)\n- Override Bootstrap defaults for dark theme consistency\n- Style sidebar, cards, tables, forms, buttons\n- Add action badges (BUY/SELL/HOLD) with color coding\n- Add status badges (pending/approved/rejected/executed)\n\nFiles affected:\n- templates/layout.templ (add inline CSS or external stylesheet)\n\nPriority: High","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T15:28:09.257327-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T18:16:51.291956-06:00","closed_at":"2026-01-17T17:20:51.311678-06:00","labels":["enhancement","priority:high","ui"]}
{"id":"trade-machine-co3","title":"Add strategy pattern for recommendation actions","description":"Action determination is hardcoded in agents/helpers.go. Add pluggable strategies for different risk profiles.\n\nCurrent problem:\n- Thresholds hardcoded (±25 for BUY/SELL)\n- No support for different risk profiles\n- Can't A/B test thresholds\n\nImplementation:\n- Create agents/strategies package\n- Define ActionStrategy interface\n- Implement ConservativeStrategy (±35 thresholds)\n- Implement AggressiveStrategy (±15 thresholds)\n- Make strategy configurable\n- Allow user-specific strategies\n\nExample:\ntype ActionStrategy interface {\n    DetermineAction(score float64, confidence float64) models.RecommendationAction\n}\n\ntype ConservativeStrategy struct {\n    BuyThreshold  float64  // 35\n    SellThreshold float64  // -35\n    MinConfidence float64  // 60\n}\n\nBenefits:\n- Support different risk profiles\n- A/B testing capabilities\n- User customization\n\nPriority: Low (Phase 3)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:19:17.843751-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T22:17:47.184451-06:00","closed_at":"2026-01-17T21:24:40.824811-06:00","labels":["enhancement","priority:low"]}
{"id":"trade-machine-d6t","title":"Fix repository abstraction - add Health method","description":"Repository exposes its connection pool directly, breaking abstraction and making it harder to swap implementations.\n\nCurrent problem:\n- handler.go:101 calls h.app.repo.Pool().Ping(ctx)\n- Breaks abstraction barrier\n- Tight coupling to pgx implementation\n\nImplementation:\n- Add Health(ctx context.Context) error method to Repository\n- Update handler.go to call repo.Health() instead\n- Remove Pool() method from public interface (or make it internal)\n\nSimple fix:\nfunc (r *Repository) Health(ctx context.Context) error {\n    return r.pool.Ping(ctx)\n}\n\nPriority: Medium (Phase 2)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:18:03.400331-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T13:36:34.452149-06:00","closed_at":"2026-01-17T13:36:34.452149-06:00","close_reason":"Closed","labels":["enhancement","priority:medium"]}
{"id":"trade-machine-fqp","title":"Add structured logging with slog","description":"Replace log.Printf with structured logging using Go's slog package (1.21+) or zap.\n\nCurrent issues:\n- Uses standard log.Printf throughout\n- No log levels or structured fields\n- Hard to filter/search logs\n- Difficult to integrate with log aggregation\n\nImplementation:\n- Create observability/logger.go\n- Initialize slog with appropriate handler (JSON for production)\n- Replace all log.Printf calls with structured logging\n- Add context fields (symbol, agent_type, error, etc.)\n\nExample:\nlogger.Warn('failed to initialize database', 'error', err, 'connection_string', sanitize(connString))\n\nPriority: High (Phase 1)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:17:23.262004-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T13:52:57.853555-06:00","closed_at":"2026-01-17T13:52:57.853555-06:00","close_reason":"Closed","labels":["enhancement","observability","priority:high"]}
{"id":"trade-machine-hc1","title":"Add health check caching to reduce API calls","description":"Currently `IsAvailable()` on each agent makes live API calls (e.g., fetching AAPL data) every time availability is checked. This wastes API quota and adds latency.\n\n**Current problem:**\n- `IsAvailable()` methods call external APIs for every health check\n- During frequent analysis requests, this creates redundant API calls\n- Adds unnecessary latency to the analysis flow\n\n**Implementation:**\n1. Add a `healthCache` struct with TTL-based caching (30-60 seconds)\n2. Store last health check result and timestamp per agent\n3. Return cached result if within TTL\n4. Only make live API call if cache is stale or missing\n\n**Example:**\n```go\ntype healthCache struct {\n    mu        sync.RWMutex\n    available bool\n    checkedAt time.Time\n    ttl       time.Duration\n}\n\nfunc (c *healthCache) IsValid() bool {\n    c.mu.RLock()\n    defer c.mu.RUnlock()\n    return time.Since(c.checkedAt) \u003c c.ttl\n}\n```\n\n**Files affected:**\n- agents/fundamental.go\n- agents/technical.go\n- agents/news.go\n\n**Benefits:**\n- Reduce external API calls by 90%+ during burst traffic\n- Faster analysis startup\n- Preserve API quota for actual analysis\n\nPriority: High","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T10:00:00-06:00","created_by":"tm-architect","updated_at":"2026-01-18T10:24:03.606938-06:00","closed_at":"2026-01-18T10:22:00-06:00"}
{"id":"trade-machine-hc2","title":"Improve partial agent failure handling with explicit reasoning","description":"When some agents fail but others succeed, the recommendation is generated but the reasoning doesn't clearly indicate which agents were unavailable.\n\n**Current behavior:**\n- Failed agents are logged but reasoning doesn't mention missing analysis\n- Confidence calculation doesn't explicitly penalize missing agents\n- User may not realize recommendation is based on partial data\n\n**Implementation:**\n1. Track which agents were skipped/failed in the synthesis phase\n2. Add explicit note in reasoning about missing agents\n3. Consider adding a `DataCompleteness` field to Recommendation\n4. Optionally reduce confidence when agents are missing\n\n**Example reasoning format:**\n```\nBased on analysis from 2 of 3 agents (Technical agent unavailable: Alpaca API timeout)\nFundamental: 50.0, News: 40.0\nNote: Technical analysis not available; recommendation confidence reduced.\n```\n\n**Files affected:**\n- agents/manager.go (synthesis logic)\n- models/recommendation.go (optional: add DataCompleteness)\n\nPriority: High","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T10:00:01-06:00","created_by":"tm-architect","updated_at":"2026-01-18T10:00:01-06:00"}
{"id":"trade-machine-hc3","title":"Extract common Claude response parsing to shared helper","description":"Each agent (fundamental, technical, news) has similar JSON parsing and normalization code for Claude responses. This creates duplication and inconsistent error handling.\n\n**Current problem:**\n- Each agent has its own `parseResponse()` or inline JSON parsing\n- Score/confidence normalization is duplicated\n- Error handling varies between agents\n\n**Implementation:**\n1. Create `agents/claude_parser.go` with shared parsing utilities\n2. Define common response structure expected from Claude\n3. Extract `parseClaudeAnalysisResponse()` helper\n4. Standardize error handling and fallback values\n\n**Example:**\n```go\n// agents/claude_parser.go\ntype ClaudeAnalysisJSON struct {\n    Score      float64  `json:\"score\"`\n    Confidence float64  `json:\"confidence\"`\n    Reasoning  string   `json:\"reasoning\"`\n    // Agent-specific fields handled via map[string]interface{}\n    Extra      map[string]interface{} `json:\"-\"`\n}\n\nfunc ParseClaudeAnalysis(response string) (*ClaudeAnalysisJSON, error)\nfunc NormalizeScore(score float64) float64  // Clamp to -100..100\nfunc NormalizeConfidence(conf float64) float64  // Clamp to 0..100\n```\n\n**Files affected:**\n- Create: agents/claude_parser.go\n- Modify: agents/fundamental.go, agents/technical.go, agents/news.go\n\nPriority: Medium","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T10:00:02-06:00","created_by":"tm-architect","updated_at":"2026-01-18T10:00:02-06:00"}
{"id":"trade-machine-hc4","title":"Extract technical indicators to separate package","description":"RSI, MACD, and SMA calculations are embedded in `technical.go`. These should be in a separate package for better testability and reusability.\n\n**Current location:**\n- agents/technical.go contains calculateRSI(), calculateMACD(), calculateSMA()\n\n**Implementation:**\n1. Create `internal/indicators/` package\n2. Move indicator calculations with clear interfaces\n3. Add comprehensive unit tests for edge cases\n4. Update technical.go to use the new package\n\n**Proposed structure:**\n```\ninternal/indicators/\n├── rsi.go        # RSI calculation\n├── macd.go       # MACD with signal line\n├── sma.go        # Simple Moving Average\n├── types.go      # Common types (Bar, etc.)\n└── indicators_test.go\n```\n\n**Benefits:**\n- Unit test indicators in isolation\n- Reusable for other features (screener, alerts)\n- Cleaner separation of concerns\n- Easier to add new indicators later\n\n**Files affected:**\n- Create: internal/indicators/*.go\n- Modify: agents/technical.go (import and use)\n\nPriority: Medium","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T10:00:03-06:00","created_by":"tm-architect","updated_at":"2026-01-18T10:00:03-06:00"}
{"id":"trade-machine-hc5","title":"Add request deduplication for repeated symbol analysis","description":"If the same symbol is analyzed twice within a short window, the system makes redundant API calls instead of returning cached results.\n\n**Current behavior:**\n- Every analysis request triggers fresh API calls\n- No short-term caching of recent analyses\n- Wastes API quota on duplicate requests\n\n**Implementation:**\n1. Add in-memory cache with short TTL (30-60 seconds) for recent analyses\n2. Before starting analysis, check if recent result exists\n3. Return cached result for duplicate requests within TTL\n4. Option: Use existing database cache table or add Redis later\n\n**Example:**\n```go\ntype analysisCache struct {\n    mu      sync.RWMutex\n    results map[string]*cachedAnalysis\n    ttl     time.Duration\n}\n\ntype cachedAnalysis struct {\n    recommendation *models.Recommendation\n    cachedAt       time.Time\n}\n```\n\n**Configuration:**\n- `ANALYSIS_CACHE_TTL_SECONDS` (default: 60)\n- `ANALYSIS_CACHE_ENABLED` (default: true)\n\n**Files affected:**\n- internal/app/app.go (add cache and check before analysis)\n- config/config.go (add cache config)\n\nPriority: Medium","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T10:00:04-06:00","created_by":"tm-architect","updated_at":"2026-01-18T10:00:04-06:00"}
{"id":"trade-machine-hc6","title":"Auto-normalize agent weights instead of validation error","description":"Currently if agent weights don't sum to 1.0, config validation fails with an error. Consider auto-normalizing instead for a better user experience.\n\n**Current behavior:**\n- Config validation checks weights sum to 1.0 (within 0.01 tolerance)\n- Returns error if not: `agent weights must sum to 1.0, got 0.95`\n- User must manually adjust weights\n\n**Proposed behavior:**\n- Auto-normalize weights if they don't sum to 1.0\n- Log warning about normalization\n- Allow explicit `AGENT_WEIGHTS_NORMALIZE=false` to preserve current strict behavior\n\n**Example:**\n```go\n// Input: fundamental=0.5, technical=0.3, news=0.3 (sum=1.1)\n// Normalized: fundamental=0.45, technical=0.27, news=0.27\n\nfunc normalizeWeights(cfg *AgentConfig) {\n    sum := cfg.WeightFundamental + cfg.WeightTechnical + cfg.WeightNews\n    if math.Abs(sum - 1.0) \u003e 0.001 {\n        log.Warn(\"auto-normalizing agent weights\", \"original_sum\", sum)\n        cfg.WeightFundamental /= sum\n        cfg.WeightTechnical /= sum\n        cfg.WeightNews /= sum\n    }\n}\n```\n\n**Files affected:**\n- config/config.go\n\nPriority: Low","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-18T10:00:05-06:00","created_by":"tm-architect","updated_at":"2026-01-18T10:00:05-06:00"}
{"id":"trade-machine-hc7","title":"Address metric cardinality issue with symbol labels","description":"Using `symbol` as a Prometheus label creates unbounded cardinality, which can cause memory issues in production with high-volume monitoring.\n\n**Current problem:**\n- Metrics like `trade_machine_analysis_requests_total{symbol=\"...\"}` create a new time series per symbol\n- With 1000s of symbols over time, Prometheus memory usage grows unbounded\n- Can cause scrape timeouts and OOM\n\n**Options:**\n1. **Remove symbol label** from high-frequency metrics (safest)\n2. **Use symbol hash** to limit cardinality (e.g., hash % 100)\n3. **Add metric expiration** to drop old series\n4. **Keep symbol only on low-frequency metrics** (recommendations created)\n\n**Recommended approach:**\n- Keep symbol on: `recommendation_actions_total` (low frequency)\n- Remove symbol from: `analysis_requests_total`, `agent_duration_seconds`\n- Add separate `symbols_analyzed_unique` gauge if count is needed\n\n**Files affected:**\n- observability/metrics.go\n\nPriority: Low (only matters at scale)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-18T10:00:06-06:00","created_by":"tm-architect","updated_at":"2026-01-18T10:00:06-06:00"}
{"id":"trade-machine-hc8","title":"Consolidate service interface definitions","description":"Service interfaces are defined in two places: `services/interfaces.go` and `agents/interfaces.go` (as type aliases). This creates confusion about the source of truth.\n\n**Current state:**\n- `services/interfaces.go`: Defines primary service interfaces\n- `agents/interfaces.go`: Has type aliases like `type BedrockService = services.BedrockService`\n\n**Issue:**\n- Unclear which file to modify when adding methods\n- Type aliases add indirection without clear benefit\n- Could confuse new contributors\n\n**Options:**\n1. **Remove type aliases** - agents package imports services directly\n2. **Move all interfaces to shared package** - e.g., `internal/contracts/`\n3. **Keep as-is** - document the pattern clearly\n\n**Recommended:** Option 1 - Remove type aliases, import directly\n\n**Files affected:**\n- agents/interfaces.go (remove or simplify)\n- agents/*.go (update imports if needed)\n\nPriority: Low","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-18T10:00:07-06:00","created_by":"tm-architect","updated_at":"2026-01-18T10:00:07-06:00"}
{"id":"trade-machine-iw8","title":"Add domain events system","description":"Side effects (like saving AgentRun) are hardcoded in the manager. Add event-driven architecture for extensibility.\n\nCurrent problem:\n- agents/manager.go has hardcoded side effects\n- Difficult to add new functionality (notifications, metrics, alerts)\n- Tight coupling\n\nImplementation:\n- Create internal/events package\n- Define Event interface and EventBus\n- Publish events: AnalysisStarted, AnalysisCompleted, RecommendationCreated\n- Subscribe handlers for logging, metrics, notifications\n- Keep existing behavior as default subscribers\n\nExample:\ntype Event interface {\n    Type() string\n    Timestamp() time.Time\n}\n\ntype AnalysisCompleted struct {\n    Symbol   string\n    Analysis *Analysis\n    Duration time.Duration\n}\n\nBenefits:\n- Easier to add features\n- Decouples components\n- Better observability\n\nPriority: Low (Phase 3)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:18:43.567854-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T22:57:25.049631-06:00","closed_at":"2026-01-17T22:57:25.049631-06:00","close_reason":"Closed","labels":["enhancement","priority:low"]}
{"id":"trade-machine-m0l","title":"Create HTMX partial templates for data display","description":"Create HTML partial templates that handlers can render for HTMX responses.\n\nTemplates to create in templates/partials/:\n1. analyze_result.templ - Analysis result with:\n   - Symbol and action badge (BUY/SELL/HOLD)\n   - Overall score gauge\n   - Confidence bar\n   - Score breakdown grid (Fundamental, Technical, News)\n   - Agent reasoning sections\n   - Approve/Reject buttons\n\n2. positions_list.templ - Portfolio positions:\n   - Summary row (total value, total P/L)\n   - Table with symbol, side, qty, avg price, current, P/L\n   - Color-coded P/L (green positive, red negative)\n\n3. recommendations_list.templ - Recommendation cards:\n   - Card per recommendation with color-coded border\n   - Symbol, action badge, status badge\n   - Score summary and confidence\n   - Approve/Reject buttons with HTMX\n\n4. trades_list.templ - Trades table:\n   - Symbol, side, qty, price, total, status\n   - Status badges\n   - Timestamps\n\n5. agent_runs_list.templ - Agent run cards:\n   - Agent type badge with color\n   - Symbol, status, duration\n   - Expandable details\n\nPriority: High","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T15:28:58.382625-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T18:16:51.292575-06:00","closed_at":"2026-01-17T17:56:18.057872-06:00","labels":["enhancement","priority:high","ui"]}
{"id":"trade-machine-mow","title":"Create reusable UI component templates","description":"Create a set of reusable templ components for consistent UI patterns.\n\nComponents to create in templates/components/:\n1. action_badge.templ - BUY/SELL/HOLD color-coded badges\n2. status_badge.templ - pending/approved/rejected/executed status badges\n3. score_gauge.templ - Visual -100 to +100 score display with color gradient\n4. confidence_bar.templ - Confidence percentage progress bar\n5. empty_state.templ - 'No data' placeholder with icon and message\n6. error_state.templ - Error display with message and retry button\n\nEach component should:\n- Accept appropriate parameters\n- Use the custom color scheme\n- Be reusable across different sections\n\nExample usage:\n@ActionBadge(models.BUY) -\u003e renders green BUY badge\n@ScoreGauge(45.2) -\u003e renders score with bullish color\n@ConfidenceBar(72) -\u003e renders 72% filled bar\n\nPriority: High","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T15:28:35.337652-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T18:16:51.293154-06:00","closed_at":"2026-01-17T17:25:58.535186-06:00","labels":["enhancement","priority:high","ui"]}
{"id":"trade-machine-qa1","title":"Improve internal/app package test coverage (currently 56%)","description":"The `internal/app` package has only 56% test coverage, below the 80% target.\n\n**Current gaps:**\n- `Startup()` lifecycle method not fully tested\n- `Shutdown()` resource cleanup not tested\n- `AnalyzeStock()` flow with nil portfolio manager paths\n- Graceful degradation when services are nil\n\n**Implementation:**\n1. Add tests for `Startup()` with various nil service combinations\n2. Add tests for `Shutdown()` verifying resource cleanup\n3. Add tests for `AnalyzeStock()` with mock portfolio manager\n4. Test error paths when database/services unavailable\n\n**Files affected:**\n- internal/app/app_test.go\n\nPriority: High","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T11:00:00-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["coverage","priority:high","testing"]}
{"id":"trade-machine-qa2","title":"Add AWS Bedrock client interface for testability","description":"The `services/bedrock.go` has only 7% test coverage because it directly uses the AWS SDK client without an interface abstraction.\n\n**Current problem:**\n- `BedrockService` directly instantiates `bedrockruntime.Client`\n- No interface for mocking AWS API calls\n- Cannot unit test prompt construction or response parsing\n\n**Implementation:**\n1. Create interface for Bedrock runtime client:\n```go\ntype BedrockRuntimeClient interface {\n    InvokeModel(ctx context.Context, params *bedrockruntime.InvokeModelInput, optFns ...func(*bedrockruntime.Options)) (*bedrockruntime.InvokeModelOutput, error)\n}\n```\n2. Update `BedrockService` to accept interface in constructor\n3. Create mock implementation for testing\n4. Add tests for prompt construction, response parsing, error handling\n\n**Files affected:**\n- services/bedrock.go\n- services/bedrock_test.go\n- services/interfaces.go\n\nPriority: High","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T11:00:01-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["coverage","priority:high","testing"]}
{"id":"trade-machine-qa3","title":"Add Alpaca trading method tests","description":"Several Alpaca service methods show 0% coverage in `services/alpaca.go`, particularly trading execution paths.\n\n**Uncovered methods (lines 47-72, 82-89, etc.):**\n- `PlaceOrder()` - order placement logic\n- `GetPositions()` - position retrieval and parsing\n- `CancelOrder()` - order cancellation\n- Error handling for market closed scenarios\n\n**Implementation:**\n1. Add mock responses for Alpaca trading API\n2. Test `PlaceOrder()` with buy/sell scenarios\n3. Test `GetPositions()` parsing with various position states\n4. Test error handling for invalid orders, market closed, insufficient funds\n\n**Files affected:**\n- services/alpaca_test.go\n\nPriority: Medium","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T11:00:02-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["coverage","priority:medium","testing"]}
{"id":"trade-machine-qa4","title":"Add API contract tests for consistent JSON responses","description":"No tests verify that API endpoints return consistent JSON schemas. This can lead to frontend/client integration issues.\n\n**Implementation:**\n1. Create `internal/api/contract_test.go`\n2. Define expected response schemas for each endpoint\n3. Verify all endpoints return expected JSON structure\n4. Test error response formats are consistent across endpoints\n5. Test pagination parameters across all list endpoints\n\n**Endpoints to cover:**\n- GET /api/health\n- POST /api/analyze\n- GET /api/recommendations\n- GET /api/recommendations/pending\n- POST /api/recommendations/{id}/approve\n- POST /api/recommendations/{id}/reject\n- GET /api/positions\n- GET /api/portfolio\n- GET /api/trades\n- GET /api/agents/runs\n- GET /api/screener/*\n\n**Files to create:**\n- internal/api/contract_test.go\n\nPriority: Medium","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T11:00:03-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["api","priority:medium","testing"]}
{"id":"trade-machine-qa5","title":"Create end-to-end test infrastructure with mock external services","description":"No end-to-end tests exist that verify the complete user journey from stock analysis to trade execution.\n\n**Required infrastructure:**\n1. Docker Compose for test PostgreSQL database\n2. Mock HTTP server for external APIs (Bedrock, Alpaca, Alpha Vantage, NewsAPI, FMP)\n3. Test harness with setup/teardown and database cleanup\n4. Fixture files for consistent test data\n\n**Proposed structure:**\n```\ne2e/\n├── docker-compose.test.yml\n├── harness.go              # Test setup/teardown\n├── mocks/\n│   ├── server.go           # Mock HTTP server\n│   ├── bedrock.go          # Bedrock response fixtures\n│   ├── alpaca.go           # Alpaca response fixtures\n│   ├── alphavantage.go     # Alpha Vantage fixtures\n│   ├── newsapi.go          # NewsAPI fixtures\n│   └── fmp.go              # FMP fixtures\n├── scenarios/\n│   ├── analysis_test.go    # Analysis workflow tests\n│   ├── trading_test.go     # Trading execution tests\n│   └── screener_test.go    # Screener workflow tests\n└── fixtures/\n    └── *.json\n```\n\n**Files to create:**\n- e2e/* (new package)\n- justfile (add e2e-test target)\n\nPriority: High","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T11:00:04-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["e2e","priority:high","testing"]}
{"id":"trade-machine-qa6","title":"Implement E2E scenario: Complete analysis workflow","description":"Create end-to-end test for the happy path analysis workflow.\n\n**Scenario: Happy Path - Complete Analysis Workflow**\n1. POST /api/analyze {\"symbol\": \"AAPL\"}\n2. Verify all 3 agents run (check agent_runs table)\n3. Verify recommendation created with status=\"pending\"\n4. POST /api/recommendations/{id}/approve\n5. Verify recommendation status=\"approved\"\n6. Verify trade record created (if trading enabled)\n7. GET /api/recommendations?status=approved → includes new rec\n\n**Mock responses needed:**\n- Bedrock: Return valid JSON with score/confidence for each agent\n- Alpaca: Return historical bars for technical analysis\n- Alpha Vantage: Return fundamentals data\n- NewsAPI: Return news articles\n\n**Depends on:** trade-machine-qa5\n\nPriority: High","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T11:00:05-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["e2e","priority:high","testing"]}
{"id":"trade-machine-qa7","title":"Implement E2E scenario: Partial agent failure","description":"Create end-to-end test verifying graceful degradation when some agents fail.\n\n**Scenario: Partial Agent Failure**\n1. Configure mock Bedrock to fail for technical analyst\n2. POST /api/analyze {\"symbol\": \"MSFT\"}\n3. Verify recommendation still created (using 2 agents)\n4. Verify agent_runs shows error for technical agent\n5. Verify confidence reflects reduced agent count\n\n**Depends on:** trade-machine-qa5\n\nPriority: Medium","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T11:00:06-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["e2e","priority:medium","testing"]}
{"id":"trade-machine-qa8","title":"Implement E2E scenario: Rate limiting behavior","description":"Create end-to-end test verifying rate limiting under concurrent load.\n\n**Scenario: Rate Limiting**\n1. Configure low concurrency limit (e.g., 1)\n2. Fire 5 concurrent POST /api/analyze requests\n3. Verify some requests return 429 or queue full error\n4. Verify successful requests complete correctly\n\n**Depends on:** trade-machine-qa5\n\nPriority: Medium","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T11:00:07-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["e2e","priority:medium","testing"]}
{"id":"trade-machine-qa9","title":"Implement E2E scenario: Screener workflow","description":"Create end-to-end test for the value screener workflow.\n\n**Scenario: Screener Workflow**\n1. POST /api/screener/run\n2. Verify screener_runs record created with status=\"running\"\n3. Poll GET /api/screener/runs/{id} until status=\"completed\"\n4. Verify candidates list populated\n5. Verify top_picks contains recommendation IDs\n6. GET /api/screener/picks returns top recommendations\n\n**Mock responses needed:**\n- FMP: Return list of screened stocks\n- All agent APIs for analysis phase\n\n**Depends on:** trade-machine-qa5\n\nPriority: Medium","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T11:00:08-06:00","created_by":"tm-qa","updated_at":"2026-01-18T10:29:17.754832-06:00","labels":["e2e","feature:screener","priority:medium","testing"]}
{"id":"trade-machine-r7a","title":"Implement PositionSizer component","description":"Quantity calculation is hardcoded to 10 shares (agents/manager.go:193-197). Create proper position sizing based on risk management.\n\nCurrent problem:\n- rec.Quantity = decimal.NewFromInt(10) hardcoded\n- No risk management\n- Ignores portfolio size, confidence, account balance\n\nImplementation:\n- Create agents/position_sizer.go\n- Define PositionSizer interface\n- Implement DefaultPositionSizer with configurable rules\n- Consider: account size, confidence, volatility, existing positions\n\nExample:\ntype PositionSizer interface {\n    CalculateQuantity(ctx context.Context, symbol string, action models.RecommendationAction, confidence float64, account models.Account) (decimal.Decimal, error)\n}\n\nStrategies:\n- Fixed dollar amount\n- Percentage of portfolio\n- Kelly criterion\n- Volatility-based sizing\n\nPriority: Low (Phase 3)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:18:27.169212-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T22:37:39.339763-06:00","closed_at":"2026-01-17T19:53:37.84684-06:00","labels":["enhancement","priority:low"]}
{"id":"trade-machine-sz5","title":"Add circuit breaker for external APIs","description":"Services use retry logic but no circuit breaker pattern. Add circuit breaker to prevent API quota exhaustion during outages.\n\nCurrent issues:\n- services/retry.go only retries, no backpressure\n- Can exhaust API quotas during outages\n- Slow failure detection\n\nImplementation:\n- Add gobreaker or similar library\n- Create services/circuit_breaker.go\n- Wrap all external API calls (AlphaVantage, NewsAPI, Alpaca, Bedrock)\n- Configure thresholds per service\n- Add health check endpoint showing breaker status\n\nConfiguration:\n- MaxRequests: 5\n- Interval: 1 minute\n- Timeout: 30 seconds\n\nPriority: Medium (Phase 2)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:17:32.491939-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T18:16:51.293722-06:00","closed_at":"2026-01-17T15:34:42.36612-06:00","labels":["enhancement","priority:medium","reliability"]}
{"id":"trade-machine-szp","title":"Improve index.templ layout and navigation","description":"Update the main index.templ with improved structure and navigation.\n\nChanges needed:\n1. Sidebar improvements:\n   - Add app title/logo header\n   - Add data-section attributes for JS targeting\n   - Improve nav link styling with proper active states\n   - Add optional count badges for pending items\n\n2. Section improvements:\n   - Add loading indicators (htmx-indicator)\n   - Add empty state placeholders\n   - Improve card layouts and spacing\n   - Add section headers with icons\n\n3. Analyze section:\n   - Larger, more prominent input\n   - Clear call-to-action button\n   - Better result container styling\n\n4. List sections (recommendations, portfolio, trades, agents):\n   - Consistent button styling\n   - Filter/sort options where appropriate\n   - Proper empty states\n\nFiles affected:\n- templates/index.templ\n\nPriority: Medium","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T15:29:49.176451-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T19:49:56.030293-06:00","closed_at":"2026-01-17T18:54:04.901002-06:00","labels":["enhancement","priority:medium","ui"]}
{"id":"trade-machine-veb","title":"Add dependency injection with wire","description":"Manual dependency wiring in main.go is verbose and error-prone. Use google/wire for compile-time dependency injection.\n\nCurrent problem:\n- main.go:90-105 manually wires all dependencies\n- Hard to maintain as dependencies grow\n- No compile-time validation of dependency graph\n\nImplementation:\n- Add google.golang.org/wire\n- Create internal/wire.go with provider functions\n- Generate wire_gen.go with InitializeApp function\n- Update main.go to call InitializeApp\n\nExample:\n//+build wireinject\nfunc InitializeApp(ctx context.Context, cfg *config.Config) (*app.App, error) {\n    wire.Build(\n        repository.NewRepository,\n        services.NewBedrockService,\n        agents.NewPortfolioManager,\n        app.NewApp,\n    )\n    return nil, nil\n}\n\nBenefits:\n- Compile-time validation\n- Easier testing\n- Clear dependency graph\n\nPriority: Low (Phase 3)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:18:16.825523-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T15:25:42.931307-06:00","closed_at":"2026-01-17T15:25:42.931307-06:00","close_reason":"Wire is no longer maintained. Manual DI in main.go is idiomatic Go and provides clear, debuggable initialization.","labels":["enhancement","priority:low"]}
{"id":"trade-machine-vnm","title":"Add Agent interface introspection methods","description":"Agent interface lacks methods to query capabilities or status. Add introspection for better runtime behavior.\n\nCurrent problem:\n- No way to check if agent dependencies are healthy\n- No metadata about agent capabilities\n- Can't dynamically disable agents\n\nImplementation:\n- Add IsAvailable(ctx context.Context) bool to Agent interface\n- Add GetMetadata() AgentMetadata to Agent interface\n- Implement in all agents (fundamental, technical, news)\n- Use in PortfolioManager to skip unavailable agents\n\nExample:\ntype Agent interface {\n    Analyze(ctx context.Context, symbol string) (*Analysis, error)\n    Name() string\n    Type() models.AgentType\n    \n    // New methods\n    IsAvailable(ctx context.Context) bool  // Check dependencies\n    GetMetadata() AgentMetadata            // Description, version, etc.\n}\n\ntype AgentMetadata struct {\n    Description string\n    Version     string\n    RequiredServices []string\n}\n\nPriority: Low (Phase 3)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:19:40.733886-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T22:46:53.024209-06:00","closed_at":"2026-01-17T22:45:27.017977-06:00","labels":["enhancement","priority:low"]}
{"id":"trade-machine-vs1","title":"Add Financial Modeling Prep (FMP) service for stock screening","description":"Add a new service to integrate with Financial Modeling Prep API for stock screening capabilities.\n\n**Why FMP:**\n- Has dedicated stock screener endpoint\n- Returns fundamental metrics (P/E, P/B, market cap, EPS, dividend yield)\n- 250 calls/day on free tier (sufficient for daily screening)\n- Better screener support than Alpha Vantage\n\n**Implementation:**\n1. Create `services/fmp/fmp.go` with FMPService struct\n2. Add FMP_API_KEY to config\n3. Implement methods:\n   - `Screen(ctx, criteria ScreenCriteria) ([]ScreenerResult, error)`\n   - `GetCompanyProfile(ctx, symbol) (*CompanyProfile, error)` (for enrichment)\n4. Add circuit breaker integration\n5. Add to service interfaces\n\n**ScreenCriteria struct:**\n```go\ntype ScreenCriteria struct {\n    MarketCapMin    int64   // e.g., 1_000_000_000 ($1B)\n    PERatioMax      float64 // e.g., 15\n    PBRatioMax      float64 // e.g., 1.5\n    EPSMin          float64 // e.g., 0 (positive earnings)\n    DividendYieldMin float64 // optional\n    Sector          string  // optional filter\n    Limit           int     // max results\n}\n```\n\n**API Endpoint:** `https://financialmodelingprep.com/api/v3/stock-screener`\n\nFiles to create:\n- services/fmp/fmp.go\n- services/fmp/fmp_test.go\n- services/fmp/models.go\n\nFiles to modify:\n- config/config.go (add FMP_API_KEY)\n- services/interfaces.go (add ScreenerService interface)\n\nPriority: High (blocks screener feature)","status":"closed","priority":1,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T23:15:00-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-18T10:28:08.047463-06:00","closed_at":"2026-01-17T23:25:38.492447-06:00","labels":["enhancement","feature:screener","priority:high"]}
{"id":"trade-machine-vs2","title":"Create ScreenerRun model and database table","description":"Add data model and persistence for screener runs to track historical screening results.\n\n**Model: ScreenerRun**\n```go\ntype ScreenerRun struct {\n    ID          uuid.UUID       `json:\"id\"`\n    RunAt       time.Time       `json:\"run_at\"`\n    Criteria    ScreenCriteria  `json:\"criteria\"`      // JSON\n    Candidates  []ScreenerCandidate `json:\"candidates\"` // JSON array\n    TopPicks    []uuid.UUID     `json:\"top_picks\"`     // Recommendation IDs\n    Duration    time.Duration   `json:\"duration\"`\n    Status      string          `json:\"status\"`        // running, completed, failed\n    Error       string          `json:\"error,omitempty\"`\n}\n\ntype ScreenerCandidate struct {\n    Symbol       string  `json:\"symbol\"`\n    CompanyName  string  `json:\"company_name\"`\n    MarketCap    int64   `json:\"market_cap\"`\n    PERatio      float64 `json:\"pe_ratio\"`\n    PBRatio      float64 `json:\"pb_ratio\"`\n    EPS          float64 `json:\"eps\"`\n    DividendYield float64 `json:\"dividend_yield\"`\n    Sector       string  `json:\"sector\"`\n    // After analysis\n    Score        *float64 `json:\"score,omitempty\"`\n    Confidence   *float64 `json:\"confidence,omitempty\"`\n    Analyzed     bool     `json:\"analyzed\"`\n}\n```\n\n**Database Migration:**\n```sql\nCREATE TABLE screener_runs (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    run_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\n    criteria JSONB NOT NULL,\n    candidates JSONB NOT NULL DEFAULT '[]',\n    top_picks UUID[] DEFAULT '{}',\n    duration_ms INTEGER,\n    status VARCHAR(20) NOT NULL DEFAULT 'running',\n    error TEXT,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()\n);\n\nCREATE INDEX idx_screener_runs_run_at ON screener_runs(run_at DESC);\nCREATE INDEX idx_screener_runs_status ON screener_runs(status);\n```\n\n**Repository Methods:**\n- `CreateScreenerRun(ctx, run) error`\n- `UpdateScreenerRun(ctx, run) error`\n- `GetScreenerRun(ctx, id) (*ScreenerRun, error)`\n- `GetLatestScreenerRun(ctx) (*ScreenerRun, error)`\n- `GetScreenerRunHistory(ctx, limit) ([]ScreenerRun, error)`\n\nFiles to create:\n- models/screener.go\n- migrations/XXX_add_screener_runs.sql\n\nFiles to modify:\n- repository/postgres.go (add methods)\n- repository/interfaces.go (add to interface)\n\nPriority: High (blocks screener feature)","status":"closed","priority":1,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T23:15:01-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-18T10:28:08.048543-06:00","closed_at":"2026-01-18T09:41:08.47723-06:00","labels":["enhancement","feature:screener","priority:high"]}
{"id":"trade-machine-vs3","title":"Implement Value Screener orchestration logic","description":"Create the screener orchestrator that coordinates the full value screening workflow.\n\n**Workflow:**\n1. Call FMP screener API with value criteria\n2. Pre-filter to top 10-15 candidates by value score\n3. Run full 3-agent analysis on each candidate (parallel)\n4. Rank by combined score × confidence\n5. Return top 3 picks\n6. Persist all results to database\n\n**Implementation:**\nCreate `screener/screener.go` with ValueScreener struct:\n\n```go\ntype ValueScreener struct {\n    fmpService      services.ScreenerService\n    portfolioMgr    *agents.PortfolioManager\n    repo            repository.Repository\n    config          *config.ScreenerConfig\n}\n\ntype ScreenerConfig struct {\n    MarketCapMin     int64   // default: 1_000_000_000\n    PERatioMax       float64 // default: 15\n    PBRatioMax       float64 // default: 1.5\n    PreFilterLimit   int     // default: 15\n    TopPicksCount    int     // default: 3\n    AnalysisTimeout  time.Duration // default: 2 minutes\n}\n\nfunc (s *ValueScreener) RunScreen(ctx context.Context) (*ScreenerRun, error)\nfunc (s *ValueScreener) GetLatestPicks(ctx context.Context) ([]Recommendation, error)\n```\n\n**Pre-filter Logic:**\nRank candidates by composite value score before full analysis:\n```go\nfunc valueScore(c ScreenerCandidate) float64 {\n    // Lower P/E and P/B = better value\n    // Normalize and weight: 50% P/E, 30% P/B, 20% dividend\n    peScore := max(0, 100 - c.PERatio*5)  // P/E of 20 = 0 score\n    pbScore := max(0, 100 - c.PBRatio*40) // P/B of 2.5 = 0 score\n    divScore := min(100, c.DividendYield*20) // 5% yield = 100 score\n    return peScore*0.5 + pbScore*0.3 + divScore*0.2\n}\n```\n\n**Parallel Analysis:**\nUse goroutines with semaphore to limit concurrent API calls:\n```go\nsem := make(chan struct{}, 5) // max 5 concurrent analyses\nvar wg sync.WaitGroup\nfor _, candidate := range preFiltered {\n    wg.Add(1)\n    go func(c ScreenerCandidate) {\n        defer wg.Done()\n        sem \u003c- struct{}{}\n        defer func() { \u003c-sem }()\n        // Run analysis...\n    }(candidate)\n}\nwg.Wait()\n```\n\nFiles to create:\n- screener/screener.go\n- screener/screener_test.go\n- screener/value_score.go\n\nFiles to modify:\n- config/config.go (add ScreenerConfig)\n\nDepends on: trade-machine-vs1, trade-machine-vs2\n\nPriority: High","status":"closed","priority":1,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T23:15:02-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-18T10:28:08.049204-06:00","closed_at":"2026-01-18T09:51:29.471469-06:00","labels":["enhancement","feature:screener","priority:high"]}
{"id":"trade-machine-vs4","title":"Add screener API endpoints","description":"Add HTTP endpoints to trigger screening and retrieve results.\n\n**Endpoints:**\n\n1. `POST /api/screener/run` - Trigger a new screener run\n   - Returns immediately with screener_run_id\n   - Screening happens async (or use SSE for progress)\n   - Response: `{ \"id\": \"uuid\", \"status\": \"running\" }`\n\n2. `GET /api/screener/latest` - Get most recent screener run\n   - Returns full ScreenerRun with top picks\n   - If running, returns partial results with status\n\n3. `GET /api/screener/runs` - Get screener history\n   - Query params: `?limit=10`\n   - Returns list of past runs (summary only)\n\n4. `GET /api/screener/runs/{id}` - Get specific screener run\n   - Returns full details including all candidates\n\n5. `GET /api/screener/picks` - Get current top picks\n   - Convenience endpoint returning just the top 3 recommendations\n   - From most recent completed run\n\n**Handler Implementation:**\n```go\nfunc (h *Handler) handleRunScreener(w http.ResponseWriter, r *http.Request)\nfunc (h *Handler) handleGetLatestScreenerRun(w http.ResponseWriter, r *http.Request)\nfunc (h *Handler) handleGetScreenerRuns(w http.ResponseWriter, r *http.Request)\nfunc (h *Handler) handleGetScreenerRun(w http.ResponseWriter, r *http.Request)\nfunc (h *Handler) handleGetTopPicks(w http.ResponseWriter, r *http.Request)\n```\n\n**HTMX Support:**\nFor HTMX requests, return HTML partials instead of JSON.\n\nFiles to modify:\n- internal/api/handler.go (add handlers)\n- internal/api/routes.go (add routes)\n\nDepends on: trade-machine-vs3\n\nPriority: High","status":"closed","priority":1,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T23:15:03-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-18T10:28:08.049816-06:00","closed_at":"2026-01-18T10:06:13.36165-06:00","labels":["enhancement","feature:screener","priority:high"]}
{"id":"trade-machine-vs5","title":"Add 'Today's Picks' UI section with screener trigger","description":"Add UI components to display today's value picks and trigger new screening.\n\n**New Section: 'Today's Picks' (default landing page)**\n\nLayout:\n```\n┌────────────────────────────────────────────────────┐\n│  💎 Today's Value Picks                            │\n│  Last updated: 9:32 AM                             │\n├────────────────────────────────────────────────────┤\n│  [Find Value Stocks]  ← Primary CTA button         │\n│                                                    │\n│  ┌─────────────────────────────────────────────┐  │\n│  │ #1  AAPL  Apple Inc.                        │  │\n│  │     Score: 72  Confidence: 85%              │  │\n│  │     P/E: 12.3  P/B: 1.2  Div: 2.1%         │  │\n│  │     [View Details] [Approve]                │  │\n│  └─────────────────────────────────────────────┘  │\n│  ┌─────────────────────────────────────────────┐  │\n│  │ #2  MSFT  Microsoft Corp                    │  │\n│  │     ...                                     │  │\n│  └─────────────────────────────────────────────┘  │\n│  ┌─────────────────────────────────────────────┐  │\n│  │ #3  JNJ   Johnson \u0026 Johnson                 │  │\n│  │     ...                                     │  │\n│  └─────────────────────────────────────────────┘  │\n├────────────────────────────────────────────────────┤\n│  Screened 87 stocks → Pre-filtered 15 → Top 3     │\n│  [View all candidates]                            │\n└────────────────────────────────────────────────────┘\n```\n\n**Templates to create:**\n1. `templates/partials/todays_picks.templ` - Main section\n2. `templates/partials/pick_card.templ` - Individual pick card\n3. `templates/partials/screener_progress.templ` - Loading state with progress\n4. `templates/partials/screener_candidates.templ` - Full candidate list modal/view\n\n**Behavior:**\n- On app open: Load latest screener run (if today)\n- If no run today or stale: Show 'Find Value Stocks' prominently\n- Button triggers `POST /api/screener/run` via HTMX\n- Show progress indicator while screening (~1-2 min)\n- Update with results when complete\n\n**HTMX Integration:**\n```html\n\u003cbutton hx-post=\"/api/screener/run\" \n        hx-target=\"#picks-container\"\n        hx-indicator=\"#screener-loading\"\u003e\n  Find Value Stocks\n\u003c/button\u003e\n```\n\nFiles to create:\n- templates/partials/todays_picks.templ\n- templates/partials/pick_card.templ\n- templates/partials/screener_progress.templ\n\nFiles to modify:\n- templates/index.templ (add Today's Picks as default section)\n- templates/layout.templ (add sidebar link)\n\nDepends on: trade-machine-vs4\n\nPriority: High","status":"closed","priority":1,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T23:15:04-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-18T11:00:54.810503-06:00","closed_at":"2026-01-18T10:53:44.67005-06:00","labels":["enhancement","feature:screener","priority:high","ui"]}
{"id":"trade-machine-vs6","title":"Wire screener into app initialization","description":"Integrate the Value Screener into the application startup and make it available to handlers.\n\n**Changes to main.go / app initialization:**\n\n1. Initialize FMP service with API key from config\n2. Create ValueScreener with dependencies\n3. Add screener to App struct\n4. Pass to handlers\n\n**App struct addition:**\n```go\ntype App struct {\n    // existing fields...\n    screener *screener.ValueScreener\n}\n```\n\n**Config additions:**\n```go\ntype Config struct {\n    // existing fields...\n    FMP      FMPConfig\n    Screener ScreenerConfig\n}\n\ntype FMPConfig struct {\n    APIKey string\n}\n\ntype ScreenerConfig struct {\n    MarketCapMin    int64\n    PERatioMax      float64\n    PBRatioMax      float64\n    PreFilterLimit  int\n    TopPicksCount   int\n    AnalysisTimeout time.Duration\n}\n```\n\n**Environment variables:**\n- `FMP_API_KEY` (required for screener)\n- `SCREENER_MARKET_CAP_MIN` (default: 1000000000)\n- `SCREENER_PE_RATIO_MAX` (default: 15)\n- `SCREENER_PB_RATIO_MAX` (default: 1.5)\n- `SCREENER_PREFILTER_LIMIT` (default: 15)\n- `SCREENER_TOP_PICKS` (default: 3)\n- `SCREENER_TIMEOUT_SECONDS` (default: 120)\n\n**Graceful degradation:**\nIf FMP_API_KEY is not set:\n- Log warning at startup\n- Screener endpoints return 503 with message\n- UI shows 'Screener not configured' state\n\nFiles to modify:\n- cmd/trade-machine/main.go\n- internal/app/app.go\n- config/config.go\n\nDepends on: trade-machine-vs1, trade-machine-vs3\n\nPriority: Medium","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T23:15:05-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-18T11:00:54.812795-06:00","closed_at":"2026-01-18T10:53:32.567654-06:00","labels":["enhancement","feature:screener","priority:medium"]}
{"id":"trade-machine-xfo","title":"Add service interface abstractions","description":"App struct currently depends on concrete service types, making testing difficult. Define interfaces for all services and depend on interfaces instead.\n\nCurrent problem:\n- app.go:18-24 uses *services.AlpacaService (concrete)\n- Hard to mock for testing\n- Tight coupling to implementations\n\nImplementation:\n- Create services/interfaces.go with TradingService, MarketDataService, etc.\n- Update App struct to use interface types\n- Update all service constructors to return interfaces\n\nBenefits:\n- Easier to mock for tests\n- Can swap implementations\n- Better separation of concerns\n\nPriority: High (Phase 1)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:17:12.993172-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T14:06:53.209499-06:00","closed_at":"2026-01-17T14:06:53.209499-06:00","close_reason":"Closed","labels":["enhancement","priority:high","testing"]}
{"id":"trade-machine-z13","title":"Refactor project structure to internal/ pattern","description":"main.go, app.go, and handler.go are in main package, making them harder to test. Reorganize following Go best practices.\n\nCurrent problem:\n- Business logic in main package\n- Harder to test\n- Doesn't follow standard Go project layout\n\nImplementation:\n- Create cmd/trade-machine/main.go (minimal entry point)\n- Move app.go → internal/app/app.go\n- Move handler.go → internal/api/handler.go\n- Create internal/api/routes.go\n- Create internal/api/middleware/\n- Update imports throughout\n\nProposed structure:\ncmd/\n  trade-machine/\n    main.go\ninternal/\n  app/\n    app.go\n    app_test.go\n  api/\n    handler.go\n    routes.go\n    middleware/\n  config/\n  observability/\n\nBenefits:\n- Better testability\n- Follows Go conventions\n- Clearer organization\n\nPriority: Low (Phase 3)","status":"closed","priority":2,"issue_type":"task","owner":"aaron@freeman.zone","created_at":"2026-01-17T11:19:29.318635-06:00","created_by":"Aaron Freeman","updated_at":"2026-01-17T18:16:51.294275-06:00","closed_at":"2026-01-17T18:05:51.109199-06:00","labels":["enhancement","priority:low","refactoring"]}
